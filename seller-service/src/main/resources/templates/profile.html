<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê¸°ì—… ì •ë³´ - íŒë§¤ì ì„¼í„°</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* [í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼] ê¸°ì—… ì •ë³´ ë¦¬ìŠ¤íŠ¸ */
        .info-list { display: flex; flex-direction: column; gap: 15px; }
        .info-row { display: flex; align-items: flex-start; border-bottom: 1px solid #f1f5f9; padding-bottom: 15px; }
        .info-row:last-child { border-bottom: none; }
        .info-label { width: 160px; font-weight: 600; color: var(--text-light); font-size: 0.95rem; }
        .info-value { flex: 1; color: var(--text-dark); font-size: 0.95rem; line-height: 1.5; }

        /* [í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼] ëª¨ë‹¬ (íŒì—…) */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;
        }
        .modal-window {
            background: white; padding: 30px; border-radius: 12px; width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15); animation: fadeIn 0.2s;
        }
        .modal-header { font-size: 1.1rem; font-weight: bold; margin-bottom: 20px; color: var(--text-dark); }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 0.85rem; font-weight: 600; color: var(--text-light); }
        .form-input {
            width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; font-size: 0.9rem;
        }
        .form-input:focus { border-color: var(--primary); outline: none; }

        .modal-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 25px; }
        .btn-cancel { padding: 8px 16px; background: #f1f5f9; border: none; border-radius: 6px; cursor: pointer; color: var(--text-light); }
        .btn-submit-modal { padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* ì•Œë¦¼ ë©”ì‹œì§€ */
        .alert { padding: 12px; margin-bottom: 20px; border-radius: 6px; text-align: center; font-size: 0.9rem; }
        .alert-success { background-color: #dcfce7; color: var(--success); border: 1px solid #bbf7d0; }

        /* ì—°ë½ì²˜ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .phone-group {
            display: flex;
            align-items: center;
            gap: 10px; /* ì…ë ¥ì°½ ì‚¬ì´ ê°„ê²© */
        }
        .phone-prefix {
            width: 30%; /* ì•ìë¦¬ ì„ íƒ ë°•ìŠ¤ ë„ˆë¹„ */
        }
        .phone-body {
            width: 70%; /* ë’·ìë¦¬ ì…ë ¥ ë°•ìŠ¤ ë„ˆë¹„ */
        }
    </style>
</head>
<body>

<header th:replace="~{fragments/header :: header('profile')}"></header>

<div class="page-container">

    <aside th:replace="~{fragments/sidebar_mypage :: sidebar('profile')}"></aside>

    <main class="main-content">

        <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>

        <div class="card">
            <div class="header" style="margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px;">
                <h2 style="font-size: 1.2rem; margin: 0;">ğŸ¢ ê¸°ì—… ì •ë³´</h2>
            </div>

            <div class="info-list">
                <div class="info-row">
                    <div class="info-label">ê¸°ì—…íšŒì› ID</div>
                    <div class="info-value" th:text="${info.sellComId}">user123</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ì‚¬ì—…ìëª…</div>
                    <div class="info-value" th:text="${info.sellComName}">ëŒ€í•­ì—ë„ˆì§€(ì£¼)</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</div>
                    <div class="info-value" th:text="${info.sellRegNum}">123-45-67890</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ëŒ€í‘œìëª…</div>
                    <div class="info-value" th:text="${info.sellRepName}">í™ê¸¸ë™</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ì‚¬ì—…ì ì£¼ì†Œ</div>
                    <div class="info-value" th:text="${info.sellComAdr}">ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ëŒ€í‘œ ì—°ë½ì²˜</div>
                    <div class="info-value" th:text="${info.sellComNum}">02-1234-5678</div>
                </div>
                <div class="info-row">
                    <div class="info-label">ëŒ€í‘œ ì´ë©”ì¼</div>
                    <div class="info-value" th:text="${info.sellComEmail}">contact@company.com</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="header" style="margin-bottom: 20px;">
                <h2 style="font-size: 1.2rem; margin: 0 0 5px 0;">ğŸ‘¨â€ğŸ’¼ ì‹¤ë¬´ ë‹´ë‹¹ì ê´€ë¦¬</h2>
                <p style="font-size: 0.9rem; color: var(--text-light);">êµ¬ë§¤ìì™€ì˜ ì›í™œí•œ ì†Œí†µì„ ìœ„í•´ ì‹¤ë¬´ ë‹´ë‹¹ìë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.</p>
            </div>

            <table>
                <thead>
                <tr>
                    <th>ì´ë¦„</th>
                    <th>ë¶€ì„œ/ì§ì±…</th>
                    <th>ì—°ë½ì²˜</th>
                    <th>ì´ë©”ì¼</th>
                    <th style="width: 140px; text-align: center;">ê´€ë¦¬</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="mgr : ${managers}">
                    <td style="font-weight: bold;" th:text="${mgr.managerName}">ê¹€ì² ìˆ˜</td>
                    <td th:text="${mgr.department}">ì˜ì—…íŒ€</td>
                    <td th:text="${mgr.phone}">010-1234-5678</td>
                    <td th:text="${mgr.email}">kim@company.com</td>
                    <td style="text-align: center; display: flex; justify-content: center; gap: 5px;">
                        <button type="button" class="btn-action btn-edit"
                                th:onclick="openEditModal( [[${mgr.subManagerId}]], [[${mgr.managerName}]], [[${mgr.department}]], [[${mgr.phone}]], [[${mgr.email}]] )">
                            ìˆ˜ì •
                        </button>
                        <form th:action="@{/seller/manager/delete/{id}(id=${mgr.subManagerId})}" method="post"
                              onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                            <button type="submit" class="btn-action btn-del">ì‚­ì œ</button>
                        </form>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(managers)}">
                    <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-light);">
                        ë“±ë¡ëœ ë‹´ë‹¹ìê°€ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€í•´ì£¼ì„¸ìš”.
                    </td>
                </tr>
                </tbody>
            </table>

            <button class="btn-primary" onclick="openManagerModal()" style="margin-top: 20px;">
                + ë‹´ë‹¹ì ì¶”ê°€
            </button>
        </div>

        <div style="margin-top: 50px; text-align: right; border-top: 1px solid #eee; padding-top: 20px;">
            <span style="font-size: 0.9rem; color: #94a3b8; margin-right: 10px;">ë” ì´ìƒ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì§€ ì•Šìœ¼ì‹œë‚˜ìš”?</span>
            <form action="/seller/withdraw" method="post" style="display: inline-block;"
                  onsubmit="return confirm('ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\níƒˆí‡´ í›„ì—ëŠ” ê³„ì •ì„ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');">
                <button type="submit" style="background: none; border: none; color: #ef4444; text-decoration: underline; cursor: pointer; font-size: 0.9rem;">
                    íšŒì› íƒˆí‡´
                </button>
            </form>
        </div>

    </main>
</div>

<div id="managerModal" class="modal-overlay">
    <div class="modal-window">
        <div class="modal-header" id="modalTitle">ìƒˆ ë‹´ë‹¹ì ë“±ë¡</div>

        <form id="managerForm" action="/seller/manager/add" method="post" onsubmit="return combinePhone()">

            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" name="managerName" class="form-input" placeholder="ì˜ˆ: ë°•ëŒ€ë¦¬" required>
            </div>
            <div class="form-group">
                <label>ë¶€ì„œ ë° ì§ì±…</label>
                <input type="text" name="department" class="form-input" placeholder="ì˜ˆ: ì˜ì—…íŒ€ ëŒ€ë¦¬" required>
            </div>

            <div class="form-group">
                <label>ì—°ë½ì²˜</label>
                <div class="phone-group">
                    <select id="phonePrefix" class="form-input phone-prefix">
                        <option value="010" selected>010</option>
                        <option value="011">011</option>
                        <option value="016">016</option>
                        <option value="017">017</option>
                        <option value="018">018</option>
                        <option value="019">019</option>
                    </select>

                    <input type="text" id="phoneBody" class="form-input phone-body"
                           placeholder="1234-5678" maxlength="9" required>
                </div>
                <input type="hidden" name="phone" id="combinedPhone">
            </div>

            <div class="form-group">
                <label>ì´ë©”ì¼</label>
                <input type="email" name="email" class="form-input" placeholder="example@email.com" required>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn-cancel" onclick="closeManagerModal()">ì·¨ì†Œ</button>
                <button type="submit" class="btn-submit-modal" id="modalSubmitBtn">ë“±ë¡í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>

<script>
    // ëª¨ë‹¬ ë‹«ê¸°
    function closeManagerModal() {
        document.getElementById('managerModal').style.display = 'none';
    }

    // ëª¨ë‹¬ ì—´ê¸°
    function openManagerModal() {
        // í¼ ë¦¬ì…‹
        document.getElementById('managerForm').reset();

        // IDê°€ managerFormì¸ ê²ƒì„ ì‚¬ìš©í•´ì•¼ í•¨
        document.getElementById('managerForm').action = "/seller/manager/add";
        document.getElementById('modalTitle').innerText = "ìƒˆ ë‹´ë‹¹ì ë“±ë¡";
        document.getElementById('modalSubmitBtn').innerText = "ë“±ë¡í•˜ê¸°";

        document.getElementById('managerModal').style.display = 'flex';
    }

    // ëª¨ë‹¬ ì—´ê¸°
    function openEditModal(id, name, dept, phone, email) {
        // ê¸°ì¡´ ê°’ ì±„ì›Œë„£ê¸°
        document.getElementsByName('managerName')[0].value = name;
        document.getElementsByName('department')[0].value = dept;
        document.getElementsByName('email')[0].value = email;

        // ì „í™”ë²ˆí˜¸ ë¶„ë¦¬ ë¡œì§ (010-1234-5678 -> 010 ê³¼ 1234-5678)
        if (phone) {
            if (phone.includes("-")) {
                var parts = phone.split("-");
                document.getElementById('phonePrefix').value = parts[0];

                // ë‚˜ë¨¸ì§€ê°€ 2ë¶€ë¶„ì´ë©´ 1234-5678, ì•„ë‹ˆë©´ ê·¸ëƒ¥ ë„£ìŒ
                if (parts.length >= 3) {
                    document.getElementById('phoneBody').value = parts[1] + "-" + parts[2];
                } else {
                    document.getElementById('phoneBody').value = parts[1];
                }
            } else {
                // í•˜ì´í”ˆ ì—†ëŠ” ê²½ìš°
                document.getElementById('phoneBody').value = phone;
            }
        }

        // ìˆ˜ì • ëª¨ë“œë¡œ ë³€ê²½
        const form = document.getElementById('managerForm');
        form.action = "/seller/manager/update/" + id; // ì»¨íŠ¸ë¡¤ëŸ¬ì— Update ë©”ì„œë“œ í•„ìš”

        document.getElementById('modalTitle').innerText = "ë‹´ë‹¹ì ì •ë³´ ìˆ˜ì •";
        document.getElementById('modalSubmitBtn').innerText = "ìˆ˜ì •í•˜ê¸°";

        document.getElementById('managerModal').style.display = 'flex';
    }

    // ì „ì†¡ ì „ ì „í™”ë²ˆí˜¸ í•©ì¹˜ê¸°
    function combinePhone() {
        var prefix = document.getElementById('phonePrefix').value;
        var body = document.getElementById('phoneBody').value;

        if (!body) {
            alert("ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return false;
        }

        var fullPhone = "";

        if(body.includes("-")) {
            fullPhone = prefix + "-" + body;
        } else {
            if(body.length >= 8) {
                fullPhone = prefix + "-" + body.substring(0, 4) + "-" + body.substring(4);
            } else {
                fullPhone = prefix + "-" + body;
            }
        }

        document.getElementById('combinedPhone').value = fullPhone;
        return true;
    }

    // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        var modal = document.getElementById('managerModal');
        if (event.target == modal) { closeManagerModal(); }
    }
</script>
</body>
</html>