<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íŒë§¤ê¸€ ê´€ë¦¬ - íŒë§¤ì ì„¼í„°</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<header th:replace="~{fragments/header :: header('profile')}"></header>

<div class="page-container">
    <aside th:replace="~{fragments/sidebar_mypage :: sidebar('sellerpost')}"></aside>

    <main class="main-content">
        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 25px;">
            <div class="header" style="margin-bottom: 0;">
                <h1>ğŸ“¢ íŒë§¤ ê²Œì‹œê¸€ ê´€ë¦¬</h1>
                <p>ë“±ë¡í•œ ë§¤ë¬¼ì„ ìˆ˜ì •í•˜ê±°ë‚˜ íŒë§¤ ìƒíƒœë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <a th:href="@{/market/write}" class="btn-primary" style="text-decoration: none;">+ ìƒˆ íŒë§¤ê¸€ ë“±ë¡</a>
        </div>

        <div class="card">
            <table>
                <colgroup>
                    <col style="width: 80px;">
                    <col>
                    <col style="width: 100px;">
                    <col style="width: 100px;">
                    <col style="width: 140px;">
                    <col style="width: 250px;">
                </colgroup>
                <thead>
                <tr>
                    <th>ì‚¬ì§„</th>
                    <th>ì œëª©</th>
                    <th>ì—ë„ˆì§€ì›</th>
                    <th>ìƒíƒœ</th>
                    <th>ê°€ê²©</th>
                    <th>ê´€ë¦¬</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="post : ${posts}">
                    <td>
                        <div th:if="${post.imageUrl != null}" style="width: 50px; height: 50px; border-radius: 6px; overflow: hidden;">
                            <img th:src="${post.imageUrl}" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div th:unless="${post.imageUrl != null}" class="thumb-placeholder">No Img</div>
                    </td>

                    <td th:text="${post.title}" style="font-weight: 600;">ì œëª©</td>

                    <td>
                        <span class="badge" style="background: #f1f5f9; color: var(--text-dark);" th:text="${post.energyType}">íƒœì–‘ê´‘</span>
                    </td>

                    <td>
                        <span class="badge"
                              th:classappend="${post.status == 'íŒë§¤ì¤‘'} ? 'status-1' : 'status-2'"
                              th:text="${post.status}">íŒë§¤ì¤‘</span>
                    </td>

                    <td th:text="${#numbers.formatInteger(post.priceKrw, 0, 'COMMA')} + 'ì›'" style="font-weight: bold;"></td>

                    <td>
                        <button type="button" class="btn-action btn-end"
                                th:if="${post.status == 'íŒë§¤ì¤‘'}"
                                th:onclick="'updateStatus(' + ${post.id} + ', \'N\')'">ì¢…ë£Œ</button>

                        <button type="button" class="btn-action btn-resume"
                                th:unless="${post.status == 'íŒë§¤ì¤‘'}"
                                th:onclick="'updateStatus(' + ${post.id} + ', \'Y\')'">ì¬ê°œ</button>

                        <button type="button" class="btn-action btn-edit"
                                th:onclick="|location.href='@{/market/edit/{id}(id=${post.id})}'|">ìˆ˜ì •</button>

                        <button type="button" class="btn-action btn-del"
                                th:onclick="'deletePost(' + ${post.id} + ')'">ì‚­ì œ</button>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(posts)}">
                    <td colspan="6" style="text-align: center; padding: 60px; color: var(--text-light);">
                        ë“±ë¡ëœ íŒë§¤ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>
                        ìš°ì¸¡ ìƒë‹¨ 'ìƒˆ íŒë§¤ê¸€ ë“±ë¡' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë§¤ë¬¼ì„ ë“±ë¡í•´ë³´ì„¸ìš”!
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </main>
</div>

<script>
    function updateStatus(id, status) {
        var actionName = (status === 'Y') ? "íŒë§¤ ì¬ê°œ" : "íŒë§¤ ì¢…ë£Œ";
        if (confirm(id + "ë²ˆ ê²Œì‹œê¸€ì„ [" + actionName + "] ìƒíƒœë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            var form = document.createElement("form");
            form.setAttribute("method", "post");
            form.setAttribute("action", "/market/status/" + id);
            var hiddenField = document.createElement("input");
            hiddenField.type = "hidden"; hiddenField.name = "status"; hiddenField.value = status;
            form.appendChild(hiddenField);
            document.body.appendChild(form);
            form.submit();
        }
    }

    function deletePost(id) {
        if (confirm("ì •ë§ë¡œ " + id + "ë²ˆ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê¸€ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            var form = document.createElement("form");
            form.setAttribute("method", "post");
            form.setAttribute("action", "/market/delete/" + id);
            document.body.appendChild(form);
            form.submit();
        }
    }
</script>
</body>
</html>