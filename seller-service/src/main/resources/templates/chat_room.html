<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>1:1 ì±„íŒ…ë°© - íŒë§¤ì ì„¼í„°</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* ì±„íŒ…ë°© ì „ìš© ìŠ¤íƒ€ì¼ */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 600px; /* ì±„íŒ…ì°½ ë†’ì´ ê³ ì • */
            background-color: #f1f5f9; /* ë°°ê²½ìƒ‰ (ì¹´í†¡ì²˜ëŸ¼ ì—°í•œ íšŒìƒ‰) */
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .chat-history {
            flex: 1;
            padding: 20px;
            overflow-y: auto; /* ìŠ¤í¬ë¡¤ ìƒê¸°ê²Œ í•¨ */
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ë©”ì‹œì§€ ë§í’ì„  ê³µí†µ */
        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
            word-wrap: break-word;
        }

        /* ìƒëŒ€ë°© (BUYER) ë©”ì‹œì§€ - ì™¼ìª½ */
        .message-left {
            align-self: flex-start;
            background-color: white;
            border: 1px solid #e2e8f0;
            border-top-left-radius: 2px; /* ë§ê¼¬ë¦¬ íš¨ê³¼ */
            color: #1e293b;
        }

        /* ë‚˜ (SELLER) ë©”ì‹œì§€ - ì˜¤ë¥¸ìª½ */
        .message-right {
            align-self: flex-end;
            background-color: #3b82f6; /* íŒŒë€ìƒ‰ */
            color: white;
            border-top-right-radius: 2px; /* ë§ê¼¬ë¦¬ íš¨ê³¼ */
        }

        .message-time {
            font-size: 0.75rem;
            margin-top: 4px;
            display: block;
            opacity: 0.7;
        }

        /* ì˜¤ë¥¸ìª½(ë‚˜) ì‹œê°„ í‘œì‹œëŠ” ë§í’ì„  ë°– ì™¼ìª½ì— ë‘ê±°ë‚˜, ì•ˆìª½ì— ë‘ . ì—¬ê¸°ì„  ì‹¬í”Œí•˜ê²Œ ì•ˆìª½ì— */
        .message-right .message-time {
            text-align: right;
            color: #e0f2fe;
        }

        /* ì…ë ¥ì°½ ì˜ì—­ */
        .chat-input-area {
            background: white;
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            resize: none; /* í¬ê¸° ì¡°ì ˆ ë§‰ê¸° */
            height: 50px;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn-send {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-send:hover {
            background-color: #2563eb;
        }

        /* ë‚ ì§œ êµ¬ë¶„ì„  (ì„ íƒì‚¬í•­) */
        .date-divider {
            text-align: center;
            font-size: 0.8rem;
            color: #94a3b8;
            margin: 10px 0;
            position: relative;
        }
    </style>
</head>
<body>

<header th:replace="~{fragments/header :: header('profile')}"></header>

<div class="page-container">
    <aside th:replace="~{fragments/sidebar_mypage :: sidebar('chat')}"></aside>

    <main class="main-content">
        <div class="header" style="margin-bottom: 15px;">
            <a th:href="@{/seller/chat/list}" style="text-decoration: none; color: #64748b; font-size: 0.9rem;">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

            <div style="margin-top: 5px;">
                <h2 style="margin: 0; font-size: 1.2rem;" th:text="${roomInfo.postTitle}">
                    ê²Œì‹œê¸€ ì œëª©
                </h2>
                <span style="font-size: 0.85rem; color: #64748b;"
                      th:text="'ğŸ’¬ with ' + ${roomInfo.opponentName}">
                    with ìƒëŒ€ë°©ì´ë¦„
                </span>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-history" id="chatHistory">

                <div th:if="${#lists.isEmpty(messages)}" style="text-align: center; color: #94a3b8; margin-top: 50px;">
                    ëŒ€í™” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë³´ì„¸ìš”! ğŸ‘‹
                </div>

                <th:block th:each="msg : ${messages}">

                    <div th:if="${msg.writerType == 'SELLER'}" class="message-bubble message-right">
                        <span th:text="${msg.content}">ë„¤, ì•ˆë…•í•˜ì„¸ìš”!</span>
                        <span class="message-time" th:text="${#temporals.format(msg.sentAt, 'HH:mm')}">10:05</span>
                    </div>

                    <div th:if="${msg.writerType == 'BUYER'}" class="message-bubble message-left">
                        <div style="font-weight: bold; font-size: 0.8rem; margin-bottom: 3px; color: #64748b;">êµ¬ë§¤ì</div>
                        <span th:text="${msg.content}">ë©”ì‹œì§€ ë‚´ìš©</span>
                        <span class="message-time" th:text="${#temporals.format(msg.sentAt, 'HH:mm')}">10:00</span>
                    </div>

                </th:block>

            </div>

            <form class="chat-input-area" th:action="@{/seller/chat/send}" method="post">
                <input type="hidden" name="requestId" th:value="${roomId}">

                <textarea name="content" class="chat-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
                <button type="submit" class="btn-send">ì „ì†¡</button>
            </form>
        </div>
    </main>
</div>

<script>
    // í˜ì´ì§€ ë¡œë”© ì‹œ ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸° (ìµœì‹  ë©”ì‹œì§€ ë³´ê²Œ)
    window.onload = function() {
        var chatHistory = document.getElementById("chatHistory");
        chatHistory.scrollTop = chatHistory.scrollHeight;
    };

    // ì—”í„°í‚¤ ëˆ„ë¥´ë©´ ì „ì†¡ë˜ê²Œ í•˜ê¸° (Shift+EnterëŠ” ì¤„ë°”ê¿ˆ)
    document.querySelector('.chat-input').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // ì¤„ë°”ê¿ˆ ë°©ì§€
            this.form.submit();
        }
    });
</script>

</body>
</html>