<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë§¤ë¬¼ ìƒì„¸ì •ë³´ - ëŒ€í•­ì—ë„ˆì§€</title>
    <link rel="stylesheet" th:href="@{/market/css/style.css}">
    <style>
        /* =========================================
           1. ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ (ì •ë³´ê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡)
           ========================================= */
        .detail-header { border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .detail-title { font-size: 1.8rem; font-weight: bold; margin-bottom: 10px; color: #333; }
        .detail-meta { color: #666; font-size: 0.95rem; display: flex; gap: 15px; align-items: center; }

        .section-header { font-size: 1.2rem; font-weight: bold; margin: 40px 0 15px; border-left: 5px solid #2fb44a; padding-left: 10px; color: #333; }

        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px; }
        .info-item { background: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #eee; }
        .info-label { color: #888; font-size: 0.85rem; margin-bottom: 8px; display: block; }
        .info-value { font-size: 1.1rem; font-weight: 600; color: #333; }

        .price-card { background: #eefbee; border: 1px solid #c3e6cb; padding: 30px; border-radius: 8px; text-align: center; margin-bottom: 30px; }
        .price-value { font-size: 2.2rem; font-weight: bold; color: #1e7e34; margin-bottom: 5px; }
        .price-sub { font-size: 1rem; color: #555; }

        .content-box { line-height: 1.6; color: #444; min-height: 200px; white-space: pre-wrap; background: #fff; border: 1px solid #eee; padding: 25px; border-radius: 8px; }

        /* =========================================
           2. ëª¨ë‹¬ì°½ ìŠ¤íƒ€ì¼ ì¶”ê°€ (ì¤‘ì•™ ì •ë ¬ ìˆ˜ì •ë¨)
           ========================================= */
        .modal-overlay {
            display: none; /* í‰ì†Œì—” ìˆ¨ê¹€ */
            position: fixed; /* í™”ë©´ ê¸°ì¤€ ê³ ì • */
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); /* ë°˜íˆ¬ëª… ë°°ê²½ */
            z-index: 9999;

            /* ì—¬ê¸°ê°€ í•µì‹¬! í™”ë©´ ì •ì¤‘ì•™ ë°°ì¹˜ */
            align-items: center;
            justify-content: center;
        }

        .modal-window {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            animation: slideDown 0.3s ease-out;
            position: relative; /* ë‚´ë¶€ ìš”ì†Œ ë°°ì¹˜ ê¸°ì¤€ */
        }

        @keyframes slideDown {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title { font-size: 1.4rem; font-weight: bold; margin-bottom: 15px; color: #333; }

        .modal-textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: none;
            font-family: inherit;
            margin-bottom: 20px;
            box-sizing: border-box; /* íŒ¨ë”© í¬í•¨ í¬ê¸° ê³„ì‚° */
        }

        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; }

        .btn-cancel { padding: 10px 20px; background: #f1f3f5; border: none; border-radius: 6px; cursor: pointer; color: #333; font-weight: 600; }
        .btn-submit { padding: 10px 20px; background: #2fb44a; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: 600; }
        .btn-cancel:hover { background: #e9ecef; }
        .btn-submit:hover { background: #25963b; }
    </style>
</head>

<body>
<div th:replace="~{fragments/header :: header('market')}"></div>
<div class="page-container">
    <div th:replace="~{fragments/sidebar_market :: sidebar('all')}"></div>

    <main class="main-content">
        <div class="card detail-header">
            <div style="margin-bottom: 15px; display: flex; gap: 8px;">
                <span class="badge status-1" th:if="${post.status == 'íŒë§¤ì¤‘'}">íŒë§¤ì¤‘</span>
                <span class="badge status-2" th:unless="${post.status == 'íŒë§¤ì¤‘'}" th:text="${post.status}">ìƒíƒœ</span>
                <span class="badge" style="background-color: #2fb44a; color: white;" th:text="${post.energyType}">íƒœì–‘ê´‘</span>
            </div>

            <div th:if="${post.imageUrl != null}" style="margin: 20px 0; text-align: center; background: #fafafa; padding: 20px; border-radius: 10px; border: 1px solid #eee;">
                <img th:src="${post.imageUrl}" alt="ë§¤ë¬¼ ìƒì„¸ ì´ë¯¸ì§€" style="max-width: 100%; max-height: 500px; border-radius: 5px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
            </div>

            <h1 class="detail-title" th:text="${post.title}">ê²Œì‹œê¸€ ì œëª©</h1>
            <div class="detail-meta">
                <span>ì‘ì„±ì:
                     <strong th:text="${sellerName}"
                             th:onclick="openCompanyModal([[${post.sellerId}]])"
                             style="cursor: pointer; color: #2fb44a; text-decoration: underline;">
                         íŒë§¤ê¸°ì—…ëª…
                     </strong>
                </span>
                <span>ğŸ“ <span th:text="|${post.location} ${post.locationDetail ?: ''}|">ì£¼ì†Œ</span></span>
                <span>ğŸ“… ë“±ë¡ì¼: <span th:text="${post.regDate != null ? #temporals.format(post.regDate, 'yyyy-MM-dd') : 'ë‚ ì§œ ë¯¸ìƒ'}">2024-01-01</span></span>
            </div>
        </div>

        <div class="card">
            <div class="section-header">ğŸ’° í¬ë§ ë§¤ë„ ë‹¨ê°€</div>
            <div class="price-card">
                <div class="price-value" th:text="${#numbers.formatInteger(post.priceKrw, 0, 'COMMA')} + ' ì›'">0 ì›</div>
                <div class="price-sub">
                    (ë‹¨ìœ„: <span th:text="${post.contractUnit == 'kWh' ? 'ì›/kWh' : 'ì›/REC'}">ì›/kWh</span>)
                    <span th:if="${post.isPriceNegotiable == 'Y'}" style="color: #d63384; font-weight: bold; margin-left: 10px;">* ê°€ê²© í˜‘ì˜ ê°€ëŠ¥</span>
                </div>
            </div>

            <div class="section-header">âš¡ ë°œì „ì†Œ ì •ë³´</div>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">ì„¤ë¹„ ìš©ëŸ‰</span>
                    <span class="info-value" th:text="${post.facilityCapacity} + ' kW'">100 kW</span>
                </div>
                <div class="info-item">
                    <span class="info-label">REC ê°€ì¤‘ì¹˜</span>
                    <span class="info-value" th:text="${post.weightingFactor}">1.0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ë¶€ì§€ ìœ í˜•</span>
                    <span class="info-value" th:text="${post.landType}">ì§€ë¶•</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ë¶€ì§€ ë©´ì </span>
                    <span class="info-value" th:text="${#numbers.formatInteger(post.landArea, 0, 'COMMA')} + ' mÂ²'">100 mÂ²</span>
                </div>
                <div class="info-item">
                    <span class="info-label">íŒë§¤ ê°€ëŠ¥ ì „ë ¥ëŸ‰</span>
                    <span class="info-value" th:text="${post.volumeKwh != null ? #numbers.formatInteger(post.volumeKwh, 0, 'COMMA') + ' kWh' : '-'}">0 kWh</span>
                </div>
                <div class="info-item">
                    <span class="info-label">íŒë§¤ ê°€ëŠ¥ REC</span>
                    <span class="info-value" th:text="${post.volumeRec != null ? #numbers.formatInteger(post.volumeRec, 0, 'COMMA') + ' REC' : '-'}">0 REC</span>
                </div>
            </div>

            <div class="section-header">ğŸ“„ ê³„ì•½ ì¡°ê±´</div>
            <div class="info-grid">
                <div class="info-item" style="grid-column: span 2;">
                    <span class="info-label">ì„ í˜¸ ê³„ì•½ ìœ í˜•</span>
                    <span class="info-value" th:text="${post.contractType}">REC í˜„ë¬¼, ì¥ê¸°</span>
                </div>
                <div class="info-item" style="grid-column: span 2;">
                    <span class="info-label">í¬ë§ ê³„ì•½ ê¸°ê°„</span>
                    <div class="info-value">
                        <span th:text="${post.contractStartDate}"></span> ~ <span th:text="${post.contractEndDate}"></span>
                        <span style="font-size: 0.9rem; color: #d63384; margin-left: 10px;" th:if="${post.isPeriodNegotiable == 'Y'}">* ê¸°ê°„ í˜‘ì˜ ê°€ëŠ¥</span>
                    </div>
                </div>
            </div>

            <div class="section-header">ğŸ“ ìƒì„¸ ì„¤ëª…</div>
            <div class="content-box" th:text="${post.content}">ë‚´ìš©</div>

            <div style="margin-top: 40px; text-align: center; display: flex; justify-content: center; gap: 15px;">
                <a th:href="@{/market/marketpost}" style="padding: 12px 30px; background: #666; color: white; border-radius: 4px; text-decoration: none;">ëª©ë¡ìœ¼ë¡œ</a>
                <button th:unless="${post.status == 'íŒë§¤ì¢…ë£Œ'}"
                        style="padding: 12px 30px; background: #2fb44a; color: white; border: none; border-radius: 4px; font-weight: bold; cursor: pointer;"
                        onclick="openModal()">
                    íŒë§¤ìì—ê²Œ ë¬¸ì˜í•˜ê¸°
                </button>
            </div>
        </div>
    </main>
</div>

<div id="inquiryModal" class="modal-overlay">
    <div class="modal-window">
        <div class="modal-title">ğŸ“¨ íŒë§¤ìì—ê²Œ ë¬¸ì˜í•˜ê¸°</div>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
            êµ¬ë§¤ í¬ë§ ë‚´ìš©ì´ë‚˜ ê¶ê¸ˆí•œ ì ì„ ë‚¨ê²¨ì£¼ì„¸ìš”.<br>
            íŒë§¤ìê°€ í™•ì¸ í›„ ì—°ë½ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.
        </p>

        <form id="inquiryForm" onsubmit="return false;">
            <input type="hidden" id="postId" th:value="${post.id}">
            <input type="hidden" id="sellerId" th:value="${post.sellerId ?: 1}">

            <textarea id="message" class="modal-textarea" placeholder="ì˜ˆ) ê°€ê²© í˜‘ì˜ê°€ ê°€ëŠ¥í•œì§€ ê¶ê¸ˆí•©ë‹ˆë‹¤. ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤." required></textarea>

            <div class="modal-actions">
                <button type="button" class="btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>

                <button type="button" class="btn-submit"
                        th:onclick="submitInquiry([[${user != null ? user.sellComName : 'ë¹„íšŒì›'}]], [[${post.title}]])">
                    ë¬¸ì˜ ë³´ë‚´ê¸°
                </button>
            </div>
        </form>
    </div>
</div>

<div id="companyModal" class="modal-overlay" style="display: none;">
    <div class="modal-window" style="max-width: 500px;">
        <div class="modal-title">ğŸ¢ ê¸°ì—… ë° ë‹´ë‹¹ì ìƒì„¸ ì •ë³´</div>

        <div id="modalContent" class="modal-scrollable-content" style="text-align: left; line-height: 1.8;">

            <div style="margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee;">
                <p><strong>íšŒì‚¬ëª…:</strong> <span id="modalComName"></span></p>
                <p><strong>ì£¼ì†Œ:</strong> <span id="modalComAdr"></span></p>
                <p><strong>ëŒ€í‘œ ì´ë©”ì¼:</strong> <span id="modalComEmail"></span></p>
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <p style="font-weight: bold; color: #2fb44a; margin-bottom: 5px;">[ì£¼ ë‹´ë‹¹ì]</p>
                <p><strong>ì„±í•¨/ë¶€ì„œ:</strong> <span id="modalMainManager"></span></p>
                <p><strong>ì—°ë½ì²˜:</strong> <span id="modalMainNum"></span></p>
            </div>

            <div id="subManagerArea"></div>
        </div>

        <div class="modal-actions" style="margin-top: 20px;">
            <button type="button" class="btn-cancel" onclick="closeCompanyModal()" style="width: 100%;">ë‹«ê¸°</button>
        </div>
    </div>
</div>
<script th:src="@{/market/js/post_detail.js}"></script>
</body>
</html>