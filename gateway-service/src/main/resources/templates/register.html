<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>íšŒì› ê°€ì…</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .register-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .register-title {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .form-control:focus {
            box-shadow: none;
            border-color: #0d6efd;
        }
        .btn-register {
            width: 100%;
            padding: 10px;
        }
        .login-link {
            text-align: center;
            margin-top: 20px;
        }
        /* d-flex ë¶€ëª¨ì— ì ìš© */
        .d-flex.gap-2 {
            align-items: stretch; /* ë†’ì´ ë§ì¶¤ */
        }
        /* ì¸í’‹ì€ flex-grow: 1ë¡œ ëŠ˜ë¦¬ê³  ë²„íŠ¼ì€ ê³ ì • ìµœì†Œ ë„ˆë¹„ */
        #sellComId {
            flex: 1; /* ê°€ëŠ¥í•œ ìµœëŒ€ ë„ˆë¹„ */
        }
        #checkIdBtn,
        #sendEmailBtn,
        #verifyEmailBtn {
            min-width: 60px; /* ìµœì†Œ 100pxë¡œ ë²„íŠ¼ ì¶©ë¶„íˆ ë„“ê²Œ */
        }
        /*#checkIdBtn,*/
        /*#sendEmailBtn,*/
        /*#verifyEmailBtn {*/
        /*    flex: 1; !* ë¶€ëª¨ flexbox ì•ˆì—ì„œ ê°€ëŠ¥í•œ ìµœëŒ€ í­ìœ¼ë¡œ ëŠ˜ë¦¼ *!*/
        /*    min-width: 60px; !* ìµœì†Œ 60px ë³´ì¥ *!*/
        /*}*/
        .pw-rules {
            display: flex;
            gap: 20px;
            padding-left: 0;
            list-style: none;
            padding-left: 0;
            margin-top: 4px;
            list-style: none;
            font-size: 12px;
        }
        .pw-rules li {
            color: #9e9e9e; /* ê¸°ë³¸ ë°ì€ íšŒìƒ‰ */
            margin-bottom: 4px;
            font-weight: bold
        }
        .pw-rules li.valid {
            color: #14df7fff; /* ë°ì€ ì´ˆë¡ */
            font-weight: bold
        }
    </style>
</head>
<body>
<div class="container">
    <div class="register-container">
        <h2 class="register-title">íšŒì› ê°€ì…</h2>
        <!--íšŒì› ìœ í˜•-->
        <div class="mb-3">
            <label class="form-label">íšŒì› ìœ í˜•</label>
            <div class="form-check">
                <input class="form-check-input" type="radio"
                       name="companyType" id="typeBuyer"
                       value="BUYER" checked>
                <label class="form-check-label" for="typeBuyer">
                    êµ¬ë§¤ì
                </label>
            </div>

            <div class="form-check">
                <input class="form-check-input" type="radio"
                       name="companyType" id="typeSeller"
                       value="SELLER">
                <label class="form-check-label" for="typeSeller">
                    íŒë§¤ì
                </label>
            </div>
        </div>

        <form id="registerForm">
            <h4 class="register-title">ê¸°ì—… ì •ë³´</h4>
            <hr>
            <div class="mb-3">
                <label for="sellComName" class="form-label">ì‚¬ì—…ìëª…</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellComName"
                        placeholder="ì‚¬ì—…ìë“±ë¡ì¦ì— ê¸°ì¬ëœ ì‚¬ì—…ìëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        name="sellComName"
                        required>
            </div>
            <div class="mb-3">
                <label for="sellRegNum" class="form-label">ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellRegNum"
                        placeholder="ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ 10ìë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        maxlength="10"
                        name="sellRegNum"
                        required>
            </div>
            <div class="mb-3">
                <label for="sellRepName" class="form-label">ëŒ€í‘œì ì„±ëª…</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellRepName"
                        placeholder="ëŒ€í‘œì ì„±ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        name="sellRepName"
                        required>
            </div>
            <div class="mb-3">
                <label for="sellComBirth" class="form-label">ê°œì—… ì¼ì</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellComBirth"
                        placeholder="YYYYMMDD"
                        name="sellComBirth"
                        maxlength="8"
                        required>
            </div>
            <div class="mb-3">
                <label for="sellComAdr" class="form-label">íšŒì‚¬ì£¼ì†Œ</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellComAdr"
                        placeholder=""
                        name="sellComAdr"
                        required>
            </div>
            <div class="mb-3">
                <label class="form-label">íšŒì‚¬ ì „í™”ë²ˆí˜¸</label>
                <div class="d-flex gap-2">
                    <select class="form-select" id="sellComNumPrefix" style="max-width: 80px;">
                        <option value="02">02</option>
                        <option value="031">031</option>
                        <option value="032">032</option>
                        <option value="051">051</option>
                        <option value="010">010</option>
                    </select>
                    <input
                            type="text"
                            class="form-control"
                            id="sellComNum"
                            placeholder="12345678"
                            maxlength="8"
                            required>
                </div>
            </div>
            </br>
            </br>
            <h4 class="register-title">íšŒì› ì •ë³´</h4>
            <hr>
            <div class="mb-3">
                <label for="sellBmName" class="form-label">ë‹´ë‹¹ì ì´ë¦„</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellBmName"
                        placeholder="í•´ë‹¹ ì—…ë¬´ë¥¼ ë‹´ë‹¹í•˜ì‹œëŠ” ë¶„ì˜ ì„±í•¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        name="sellBmName"
                        required>
            </div>
            <div class="mb-3">
                <label class="form-label">ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸</label>
                <div class="d-flex gap-2">
                    <select class="form-select" id="sellBmNumPrefix" style="max-width: 80px;">
                        <option value="010" selected>010</option>
                        <option value="011">011</option>
                        <option value="016">016</option>
                        <option value="017">017</option>
                    </select>
                    <input
                            type="text"
                            class="form-control"
                            id="sellBmNum"
                            placeholder="í•´ë‹¹ ì—…ë¬´ë¥¼ ë‹´ë‹¹í•˜ì‹œëŠ” ë¶„ì˜ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                            maxlength="8"
                            required>
                </div>
            </div>
            <div class="mb-3">
                <label for="sellBmDep" class="form-label">ë‹´ë‹¹ì ë¶€ì„œ</label>
                <input
                        type="text"
                        class="form-control"
                        id="sellBmDep"
                        placeholder="í•´ë‹¹ ì—…ë¬´ë¥¼ ë‹´ë‹¹í•˜ì‹œëŠ” ë¶„ì˜ ë¶€ì„œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        name="sellBmDep"
                        required>
            </div>
            <div class="mb-3">
                <label for="sellComId" class="form-label">ì•„ì´ë””</label>
                <div class="d-flex gap-2">
                    <input
                            type="text"
                            class="form-control"
                            id="sellComId"
                            placeholder="3~15ì ì˜ë¬¸, ìˆ«ìë¡œ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                            required
                            pattern="^[A-Za-z0-9]{3,15}$">
                    <button type="button" class="btn btn-secondary" id="checkIdBtn">
                        ì¤‘ë³µ í™•ì¸
                    </button>
                </div>
                <div id="id-error" style="color:red; font-size:12px;"></div>
            </div>
            <div class="mb-3">
                <label for="sellComPw" class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input
                        type="password"
                        class="form-control"
                        id="sellComPw"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        name="sellComPw"
                        required
                        pattern="^[A-Za-z0-9!@#$%^&*]{8,30}$">

                <ul id="pwRules" class="pw-rules">
                    <li></li>
                    <li id="rule-length">8~30ì</li>
                    <li id="rule-letter">ì˜ë¬¸ ëŒ€Â·ì†Œë¬¸ì</li>
                    <li id="rule-number">ìˆ«ì</li>
                    <li id="rule-special">íŠ¹ìˆ˜ë¬¸ì</li>
                </ul>
                    <!--ë¹„ë°€ë²ˆí˜¸ í™•ì¸-->
                <input
                        type="password"
                        class="form-control mt-2"
                        id="sellComPwConfirm"
                        placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œ ë²ˆ ë” ì…ë ¥í•´ì£¼ì„¸ìš”"
                        required />
                <div id="pwMessage" style="font-size:12px; color:red;"></div>
            </div>

            <div class="mb-3">
                <label for="sellComEmail" class="form-label">ì´ë©”ì¼</label>
                <div class="d-flex gap-2">
                    <input
                            type="email"
                            class="form-control"
                            id="sellComEmail"
                            placeholder="í•´ë‹¹ ì—…ë¬´ì— ì‚¬ìš©í•  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
                            required>
                    <button type="button" class="btn btn-outline-secondary" id="sendEmailBtn">
                        ì¸ì¦
                    </button>
                </div>
            </div>

            <div class="mb-3">
                <label for="emailCode" class="form-label">ì¸ì¦ë²ˆí˜¸</label>
                <div class="d-flex gap-2">
                    <input
                            type="text"
                            class="form-control"
                            id="emailCode"
                            maxlength="6"
                            readonly>
                    <button type="button" class="btn btn-outline-primary" id="verifyEmailBtn">
                        í™•ì¸
                    </button>
                </div>
                <div id="email-msg" style="font-size:12px;"></div>
            </div>
            </br>
            </br>
            <h4 class="register-title">ì•½ê´€ ë™ì˜</h4>
            <hr>
                    <!--ì•½ê´€ë™ì˜ ë‚´ìš©ì´ ìƒˆë¡œìš´ ì°½ì— ëœ° ì˜ˆì •-->
            <div class="mb-3 form-check">
                <input
                        type="checkbox"
                        class="form-check-input"
                        id="termsCheck"
                        required>
                <label class="form-check-label" for="termsCheck">
                    [í•„ìˆ˜]
                    <a href="terms.html" target="_blank" style="color:blue; text-decoration:underline;">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</a>ì— ë™ì˜í•©ë‹ˆë‹¤.
                </label>
            </div>
            <div class="mb-3 form-check">
                <input
                        type="checkbox"
                        class="form-check-input"
                        id="privacyCheck"
                        required>
                <label class="form-check-label" for="privacyCheck">
                    [í•„ìˆ˜]
                    <a href="privacy.html" target="_blank" style="color:blue; text-decoration:underline;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤.
                </label>
            </div>
            <div class="mb-3 form-check">
                <input
                        type="checkbox"
                        class="form-check-input"
                        id="marketingCheck">
                <label class="form-check-label" for="marketingCheck">
                    [ì„ íƒ]
                    <a href="marketing.html" target="_blank" style="color:blue; text-decoration:underline;">ë§ˆì¼€íŒ… ì´ìš©ì•½ê´€</a>ì— ë™ì˜í•©ë‹ˆë‹¤.
                </label>
            </div>


            <div class="d-grid">
                <button type="submit" class="btn btn-primary btn-register">íšŒì› ê°€ì…</button>
            </div>
            <div class="login-link">
                <a href="/login">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const sellComIdInput = document.getElementById('sellComId');
    const idError = document.getElementById('id-error');
    const checkIdBtn = document.getElementById('checkIdBtn');
    const registerForm = document.getElementById('registerForm');
    const idRegex = /^[A-Za-z0-9]{3,15}$/;

    let isIdChecked = false;

    const emailInput = document.getElementById('sellComEmail');
    const sendEmailBtn = document.getElementById('sendEmailBtn');
    const verifyEmailBtn = document.getElementById('verifyEmailBtn');
    const emailCodeInput = document.getElementById('emailCode');
    const emailMsg = document.getElementById('email-msg');

    let isEmailVerified = false;

    const pw = document.getElementById("sellComPw");
    const pwConfirm = document.getElementById("sellComPwConfirm");
    const msg = document.getElementById("pwMessage");

    const pwInput = document.getElementById('sellComPw');

    const ruleLength = document.getElementById('rule-length');
    const ruleLetter = document.getElementById('rule-letter');
    const ruleNumber = document.getElementById('rule-number');
    const ruleSpecial = document.getElementById('rule-special');

    const termsCheck = document.getElementById('termsCheck');
    const privacyCheck = document.getElementById('privacyCheck');

    pwInput.addEventListener('input', function () {
        const value = pwInput.value;
        // 8~30ì
        toggleRule(ruleLength, value.length >= 8 && value.length <= 30);
        // ì˜ë¬¸ ëŒ€ì†Œë¬¸ì
        toggleRule(ruleLetter, /[A-Za-z]/.test(value));
        // ìˆ«ì
        toggleRule(ruleNumber, /[0-9]/.test(value));
        // íŠ¹ìˆ˜ë¬¸ì
        toggleRule(ruleSpecial, /[!@#$%^&*]/.test(value));
    });

    function toggleRule(element, condition) {
        if (condition) {
            element.classList.add('valid');
        } else {
            element.classList.remove('valid');
        }
    }

    // ğŸ”¹ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ ë²„íŠ¼
    checkIdBtn.addEventListener('click', async () => {
        const sellComId = sellComIdInput.value.trim();
        idError.textContent = '';
        idError.style.color = 'red';
        isIdChecked = false;

        if (!sellComId) {
            idError.textContent = 'ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
            return;
        }
        if (!idRegex.test(sellComId)) {
            idError.textContent = 'ì•„ì´ë””ëŠ” 3~15ì ì˜ë¬¸, ìˆ«ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
            sellComIdInput.focus();
            return;
        }

        try {
            const res = await fetch(`/api/auth/check-id?sellComId=${sellComId}`);
            const exists = await res.json();

            if (exists) {
                idError.textContent = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                sellComIdInput.value = '';
                sellComIdInput.focus();
            } else {
                idError.style.color = 'green';
                idError.textContent = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.';
                isIdChecked = true;
            }
        } catch (e) {
            idError.textContent = 'ì¤‘ë³µ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        }
    });

    // ğŸ”¹ ì•„ì´ë”” ì…ë ¥ê°’ ë³€ê²½ ì‹œ ë‹¤ì‹œ ì¤‘ë³µ í™•ì¸ í•„ìš”
    sellComIdInput.addEventListener('input', () => {
        isIdChecked = false;
        idError.textContent = '';
    });

    // ğŸ”¹ íšŒì›ê°€ì… submit ì‹œ ì¤‘ë³µ í™•ì¸ ì—¬ë¶€ ê²€ì‚¬
    registerForm.addEventListener('submit', async function(e) {
        e.preventDefault();

        // í•„ìˆ˜ ì•½ê´€ ë™ì˜ í™•ì¸
        if (!termsCheck.checked) {
            alert('ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
            termsCheck.focus();
            return;
        }
        if (!privacyCheck.checked) {
            alert('ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
            privacyCheck.focus();
            return;
        }

        // ê°œì—…ì¼ì, ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸, íšŒì‚¬ ì „í™”ë²ˆí˜¸, ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸ í¬ê¸°
        if (document.getElementById('sellRegNum').value.length !== 10) {
            alert('ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ëŠ” 10ìë¦¬ì…ë‹ˆë‹¤.');
            document.getElementById('sellRegNum').focus();
            return;
        }
        if (document.getElementById('sellComNum').value.length < 7) {
            alert('íšŒì‚¬ ì „í™”ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            document.getElementById('sellComNum').focus();
            return;
        }
        if (document.getElementById('sellBmNum').value.length < 7) {
            alert('ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸ë¥¼ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            document.getElementById('sellBmNum').focus();
            return;
        }
        if (document.getElementById('sellComBirth').value.length !== 8) {
            alert('ê°œì—…ì¼ìëŠ” 1999ë…„ 1ì›” 1ì¼ì´ë¼ë©´, 19990101ì²˜ëŸ¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            document.getElementById('sellComBirth').focus();
            return;
        }

        if (!isIdChecked) {
            idError.style.color = 'red';
            idError.textContent = 'ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ì„ í•´ì£¼ì„¸ìš”.';
            sellComIdInput.focus();
            return;
        }

        // ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ì¶”ê°€
        if (!checkPasswordMatch()) {
            pwConfirm.focus();
            return;
        }

        if (!checkPasswordStrength(pw.value)) {
            msg.textContent = 'ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ ëª¨ë‘ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.';
            msg.style.color = 'red';
            pw.focus();
            return;
        }

        // ì´ë©”ì¼ ì¸ì¦ í™•ì¸
        if (!isEmailVerified) {
            emailMsg.style.color = 'red';
            emailMsg.textContent = 'ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.';
            emailInput.focus();
            return;
        }

        // êµ¬ë§¤ì íŒë§¤ì ì„ íƒ
        const companyType = document.querySelector(
            'input[name="companyType"]:checked'
        ).value;

        const sellComNum =
            document.getElementById('sellComNumPrefix').value
            + '-' +
            document.getElementById('sellComNum').value;
        const sellBmNum =
            document.getElementById('sellBmNumPrefix').value
            + '-' +
            document.getElementById('sellBmNum').value;

        const payload = {
            companyType, // ì¶”ê°€
            sellComName: document.getElementById('sellComName').value, // ì‚¬ì—…ìëª…
            sellRegNum: document.getElementById('sellRegNum').value, // ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸
            sellRepName: document.getElementById('sellRepName').value, // ëŒ€í‘œì ì„±ëª…
            sellComBirth: document.getElementById('sellComBirth').value, // ê°œì—…ì¼ì
            sellComAdr: document.getElementById('sellComAdr').value, // íšŒì‚¬ ì£¼ì†Œ
            sellComNum, // íšŒì‚¬ ì „í™”ë²ˆí˜¸
            sellBmName: document.getElementById('sellBmName').value, // ë‹´ë‹¹ì ì„±ëª…
            sellBmNum, // ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸
            sellBmDep: document.getElementById('sellBmDep').value, // ë‹´ë‹¹ì ë¶€ì„œ
            sellComId: sellComIdInput.value, // Id
            sellComPw: pw.value, // Password
            sellComPwConfirm: pwConfirm.value, // ë¹„ë°€ë²ˆí˜¸ í™•ì¸
            sellComEmail: emailInput.value, // Email
            marketingCheck: document.getElementById('marketingCheck').checked ? "Y" : "N" //ë§ˆì¼€íŒ… ì´ìš©ì•½ê´€ ì²´í¬ ì—¬ë¶€
        };

        try {
            const response = await fetch('/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                alert('íšŒì› ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/login';
            } else {
                const error = await response.text();
                alert('íšŒì› ê°€ì… ì‹¤íŒ¨: ' + error);
            }
        } catch (err) {
            alert('íšŒì› ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });

    // ì „í™”ë²ˆí˜¸ ìˆ«ìë§Œ ë„£ìœ¼ì„¸ìš”
    function allowOnlyNumbers(input) {
        input.addEventListener('input', () => {
            input.value = input.value.replace(/[^0-9]/g, '');
        });
    }

    // ê°ê° ê°œì—…ì¼ì, ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸, íšŒì‚¬ ì „í™”ë²ˆí˜¸, ë‹´ë‹¹ì ì „í™”ë²ˆí˜¸
    allowOnlyNumbers(document.getElementById('sellComBirth'));
    allowOnlyNumbers(document.getElementById('sellRegNum'));
    allowOnlyNumbers(document.getElementById('sellComNum'));
    allowOnlyNumbers(document.getElementById('sellBmNum'));

    // ë¹„ë°€ë²ˆí˜¸ ì œì•½ ì¡°ê±´ í™•ì¸ìš©
    function checkPasswordStrength(password) {
        const hasLetter = /[A-Za-z]/.test(password);
        const hasNumber = /[0-9]/.test(password);
        const hasSpecial = /[!@#$%^&*]/.test(password);
        const validLength = password.length >= 8 && password.length <= 30;

        return hasLetter && hasNumber && hasSpecial && validLength;
    }

    function checkPasswordMatch() {
        if (!pw.value || !pwConfirm.value) {
            msg.textContent = "";
            return false;
        }
        if (pw.value !== pwConfirm.value) {
            msg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            msg.style.color = "red";
            return false;
        } else {
            msg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.";
            msg.style.color = "green";
            return true;
        }
    }

    pw.addEventListener("keyup", checkPasswordMatch);
    pwConfirm.addEventListener("keyup", checkPasswordMatch);

    // ì¸ì¦ ë©”ì¼ ì „ì†¡
    sendEmailBtn.addEventListener('click', async () => {
        const email = emailInput.value.trim();
        emailMsg.textContent = '';
        isEmailVerified = false;

        if (!email) {
            emailMsg.textContent = 'ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.';
            emailMsg.style.color = 'red';
            return;
        }

        try {
            const res = await fetch('/api/auth/email/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email
                })
            });

            if (!res.ok) {
                emailMsg.textContent = 'ì´ë©”ì¼ ì „ì†¡ ì‹¤íŒ¨';
                emailMsg.style.color = 'red';
                return;
            }

            const data = await res.json(); // { code }

            // ë‚´ë¶€ì ìœ¼ë¡œ ì¸ì¦ë²ˆí˜¸ ì €ì¥
            emailCodeInput.value = data.code;
            emailCodeInput.readOnly = true;

            // ğŸ”¹ alertì°½ ë„ìš°ê¸°
            alert('ì¸ì¦ë²ˆí˜¸ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•˜ì„¸ìš”.');

            // ìƒíƒœ ë©”ì‹œì§€
            emailMsg.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.';
            emailMsg.style.color = 'blue';
        } catch (err) {
            emailMsg.textContent = 'ì´ë©”ì¼ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            emailMsg.style.color = 'red';
        }
    });

    // ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸
    verifyEmailBtn.addEventListener('click', async () => {
        const email = emailInput.value.trim();
        const code = emailCodeInput.value.trim();

        const res = await fetch('/api/auth/email/verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                email,
                code
            })
        });

        if (res.ok) {
            emailMsg.textContent = 'ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ';
            emailMsg.style.color = 'green';
            isEmailVerified = true;

            verifyEmailBtn.disabled = true;
        } else {
            emailMsg.textContent = 'ì¸ì¦ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
            emailMsg.style.color = 'red';
            isEmailVerified = false;
        }
    });

</script>
</body>
</html>
