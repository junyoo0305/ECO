<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>판매회원 관리</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/common.css"> </head>
<body>

<div class="wrapper">
    <aside th:replace="~{fragments/sidebar :: sidebar('seller')}"></aside>

    <div class="main-panel">
        <header th:replace="~{fragments/header :: header}"></header>

        <div class="content">
            <h2 class="page-title">판매회원 관리</h2>

            <div class="search-area">
                <select id="searchType">
                    <option value="all">전체</option>
                    <option value="name">회사명</option>
                    <option value="manager">담당자명</option>
                </select>
                <input type="text" id="searchKeyword" placeholder="검색어 입력">
                <button class="btn-search" id="btnSearch">검색</button>
            </div>

            <table class="list-table">
                <colgroup>
                    <col style="width: 10%;">
                    <col style="width: 25%;">
                    <col style="width: 15%;">
                    <col style="width: 15%;">
                    <col style="width: 15%;">
                    <col style="width: 20%;">
                </colgroup>
                <thead>
                <tr>
                    <th>번호</th>
                    <th>회사명</th>
                    <th>담당자명</th>
                    <th>아이디</th>
                    <th>부서</th>
                    <th>가입일</th>
                </tr>
                </thead>
                <tbody id="seller-list-body">
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // [보안관] 로그인 체크
    fetch('/api/check-login').then(res => { if(res.status === 401) location.href = '/adminlogin'; });

    document.addEventListener('DOMContentLoaded', function() {
        loadSellerList();
    });

    function loadSellerList() {
        fetch('/admin/api/sellers')
            .then(response => {
                if (!response.ok) throw new Error('네트워크 응답이 올바르지 않습니다.');
                return response.json();
            })
            .then(data => {
                const tableBody = document.getElementById('seller-list-body');
                tableBody.innerHTML = '';

                if (!data || data.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="6">등록된 판매회원이 없습니다.</td></tr>';
                    return;
                }

                data.forEach((item, index) => {
                    // [수정] 날짜 필드가 없으므로 일단 하이픈(-) 처리
                    // 만약 User 엔티티에 가입일 필드(createDate 등)를 추가하면 그때 수정하세요.
                    let dateStr = "-";
                    if (item.regDate) {
                        dateStr = item.regDate.substring(0, 10);
                    }

                    const row = `
                        <tr>
                            <td>${index + 1}</td> <td style="text-align: left; padding-left: 20px;">
                                <a href="/sellerview?seq=${item.id}"
                                   style="color: #2b5585; font-weight: bold; text-decoration: underline;">
                                    ${item.sellComName}
                                </a>
                            </td>
                            <td>${item.sellBmName}</td>
                            <td>${item.sellComId}</td>
                            <td>${item.sellBmDep}</td>
                            <td>${dateStr}</td>
                        </tr>
                    `;
                    tableBody.insertAdjacentHTML('beforeend', row);
                });
            })
            .catch(err => {
                console.error(err);
                const tableBody = document.getElementById('seller-list-body');
                tableBody.innerHTML = '<tr><td colspan="6">데이터를 불러오는 중 오류가 발생했습니다.</td></tr>';
            });
    }
</script>
</body>
</html>